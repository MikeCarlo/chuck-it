<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chuck It! | AI Chuck Norris Joke Generator</title>
  <meta name="description" content="Generate hilarious AI-powered Chuck Norris jokes with custom images. Walker, Texas Ranger approved!">
  <meta name="keywords" content="Chuck Norris, jokes, meme generator, AI, Walker Texas Ranger, funny">
  <meta property="og:title" content="Chuck It! - AI Chuck Norris Joke Generator">
  <meta property="og:description" content="Generate hilarious AI-powered Chuck Norris jokes with custom images.">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      background: url('https://images.unsplash.com/photo-1500964757637-c85e8a162699?w=1920&q=80') center center / cover no-repeat fixed;
      font-family: 'Oswald', sans-serif;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(26, 10, 0, 0.7);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      max-width: 900px;
      width: 100%;
      text-align: center;
      position: relative;
      z-index: 1;
    }

    h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(3rem, 10vw, 6rem);
      color: #ffd700;
      text-shadow: 3px 3px 0 #8b4513, 6px 6px 0 rgba(0,0,0,0.3);
      margin-bottom: 10px;
      letter-spacing: 4px;
    }

    .subtitle {
      font-size: 1.2rem;
      color: #d4a574;
      margin-bottom: 40px;
      text-transform: uppercase;
      letter-spacing: 3px;
    }

    .badge {
      display: inline-block;
      background: linear-gradient(180deg, #c9a227 0%, #8b6914 100%);
      padding: 8px 20px;
      border-radius: 50px;
      font-size: 0.9rem;
      color: #1a0a00;
      font-weight: 700;
      margin-bottom: 30px;
      border: 2px solid #ffd700;
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
    }

    .input-section {
      margin-bottom: 30px;
    }

    .topic-input {
      width: 100%;
      max-width: 500px;
      padding: 18px 25px;
      font-size: 1.2rem;
      font-family: 'Oswald', sans-serif;
      border: 3px solid #8b4513;
      border-radius: 10px;
      background: rgba(0,0,0,0.5);
      color: #fff;
      text-align: center;
      outline: none;
      transition: all 0.3s ease;
    }

    .topic-input::placeholder {
      color: #a08060;
    }

    .topic-input:focus {
      border-color: #ffd700;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
    }

    .generate-btn {
      display: inline-block;
      margin-top: 20px;
      padding: 18px 50px;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1.8rem;
      color: #1a0a00;
      background: linear-gradient(180deg, #ffd700 0%, #c9a227 50%, #8b6914 100%);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 3px;
      box-shadow: 0 6px 0 #5c4a1f, 0 10px 30px rgba(0,0,0,0.4);
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .generate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 0 #5c4a1f, 0 15px 40px rgba(0,0,0,0.5);
    }

    .generate-btn:active {
      transform: translateY(4px);
      box-shadow: 0 2px 0 #5c4a1f, 0 5px 20px rgba(0,0,0,0.3);
    }

    .generate-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    .result-section {
      margin-top: 40px;
      display: none;
    }

    .result-section.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .image-container {
      position: relative;
      display: inline-block;
      max-width: 100%;
      border: 5px solid #8b4513;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 50px rgba(0,0,0,0.5), 0 0 30px rgba(255, 215, 0, 0.2);
    }

    .generated-image {
      max-width: 100%;
      width: 700px;
      height: auto;
      display: block;
    }

    .joke-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 30px;
      background: rgba(0,0,0,0.4);
    }

    .joke-text {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(1.2rem, 4vw, 2rem);
      color: #fff;
      text-shadow: 2px 2px 4px #000, -2px -2px 4px #000, 2px -2px 4px #000, -2px 2px 4px #000;
      text-align: center;
      line-height: 1.4;
      max-width: 90%;
    }

    .share-section {
      margin-top: 30px;
    }

    .share-title {
      font-size: 1.1rem;
      color: #d4a574;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .share-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .share-btn {
      padding: 12px 25px;
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      border: 2px solid;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .share-btn.twitter {
      background: #1da1f2;
      border-color: #1da1f2;
      color: #fff;
    }

    .share-btn.facebook {
      background: #4267b2;
      border-color: #4267b2;
      color: #fff;
    }

    .share-btn.copy {
      background: transparent;
      border-color: #ffd700;
      color: #ffd700;
    }

    .share-btn.download {
      background: #28a745;
      border-color: #28a745;
      color: #fff;
    }

    .share-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }

    .loading {
      display: none;
      margin-top: 40px;
    }

    .loading.active {
      display: block;
    }

    .loading-text {
      font-size: 1.5rem;
      color: #ffd700;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 5px solid rgba(255, 215, 0, 0.3);
      border-top-color: #ffd700;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .footer {
      margin-top: 50px;
      font-size: 0.9rem;
      color: #8b6914;
    }

    .footer a {
      color: #d4a574;
      text-decoration: none;
    }

    .footer a:hover {
      color: #ffd700;
    }

    .texas-star {
      font-size: 2rem;
      color: #ffd700;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    /* Canvas for generating final image */
    #memeCanvas {
      display: none;
    }

    .error-message {
      color: #ff6b6b;
      margin-top: 20px;
      padding: 15px;
      background: rgba(255, 0, 0, 0.1);
      border-radius: 10px;
      display: none;
    }

    .error-message.active {
      display: block;
    }

    .api-key-section {
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      border: 1px solid #8b4513;
    }

    .api-key-section label {
      display: block;
      margin-bottom: 10px;
      color: #d4a574;
      font-size: 0.9rem;
    }

    .api-key-input {
      width: 100%;
      max-width: 400px;
      padding: 12px 15px;
      font-size: 0.9rem;
      font-family: monospace;
      border: 2px solid #5c2800;
      border-radius: 8px;
      background: rgba(0,0,0,0.5);
      color: #fff;
      text-align: center;
    }

    .api-key-input:focus {
      outline: none;
      border-color: #ffd700;
    }

    .api-note {
      font-size: 0.8rem;
      color: #8b6914;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="texas-star">‚≠ê</div>
    <h1>CHUCK IT!</h1>
    <p class="subtitle">AI-Powered Chuck Norris Joke Generator</p>
    <div class="badge">ü§† Walker, Texas Ranger Approved ü§†</div>

    <div class="api-key-section">
      <label for="apiKey">Enter your OpenAI API Key (stored locally only)</label>
      <input type="password" id="apiKey" class="api-key-input" placeholder="sk-...">
      <p class="api-note">Your key stays in your browser. Never sent anywhere except OpenAI.</p>
    </div>

    <div class="input-section">
      <input type="text" id="topicInput" class="topic-input" placeholder="Enter a topic (e.g., programming, pizza, golf...)" maxlength="50">
      <br>
      <button id="generateBtn" class="generate-btn">ü§† Chuck It! ü§†</button>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p class="loading-text" id="loadingText">Chuck Norris is thinking...</p>
    </div>

    <div class="error-message" id="errorMessage"></div>

    <div class="result-section" id="resultSection">
      <div class="image-container" id="imageContainer">
        <img id="generatedImage" class="generated-image" src="" alt="Chuck Norris Joke">
        <div class="joke-overlay">
          <p class="joke-text" id="jokeText"></p>
        </div>
      </div>

      <div class="share-section">
        <p class="share-title">Share the Legend</p>
        <div class="share-buttons">
          <a href="#" class="share-btn twitter" id="shareTwitter">
            <span>ùïè</span> Tweet
          </a>
          <a href="#" class="share-btn facebook" id="shareFacebook">
            <span>f</span> Share
          </a>
          <button class="share-btn copy" id="copyJoke">
            <span>üìã</span> Copy Joke
          </button>
          <button class="share-btn download" id="downloadBtn">
            <span>‚¨áÔ∏è</span> Download
          </button>
        </div>
      </div>
    </div>

    <canvas id="memeCanvas"></canvas>

    <footer class="footer">
      <p>Chuck Norris doesn't need AI. AI needs Chuck Norris.</p>
      <p style="margin-top: 10px;">Built with roundhouse kicks by <a href="https://powerbi.tips" target="_blank">PowerBI.tips</a></p>
    </footer>
  </div>

  <script>
    const apiKeyInput = document.getElementById('apiKey');
    const topicInput = document.getElementById('topicInput');
    const generateBtn = document.getElementById('generateBtn');
    const loading = document.getElementById('loading');
    const loadingText = document.getElementById('loadingText');
    const resultSection = document.getElementById('resultSection');
    const generatedImage = document.getElementById('generatedImage');
    const jokeText = document.getElementById('jokeText');
    const errorMessage = document.getElementById('errorMessage');
    const canvas = document.getElementById('memeCanvas');
    const ctx = canvas.getContext('2d');

    // Load saved API key
    const savedKey = localStorage.getItem('openai_api_key');
    if (savedKey) {
      apiKeyInput.value = savedKey;
    }

    // Save API key on change
    apiKeyInput.addEventListener('change', () => {
      localStorage.setItem('openai_api_key', apiKeyInput.value);
    });

    const loadingMessages = [
      "Chuck Norris is thinking...",
      "Roundhouse kicking the AI...",
      "Chuck Norris counted to infinity. Twice.",
      "Loading at the speed of Chuck...",
      "Chuck Norris doesn't wait for loading...",
      "Generating pure awesomeness...",
      "Walker, Texas Ranger is on the case..."
    ];

    let loadingInterval;

    function showLoading() {
      loading.classList.add('active');
      resultSection.classList.remove('active');
      errorMessage.classList.remove('active');
      generateBtn.disabled = true;
      
      let i = 0;
      loadingInterval = setInterval(() => {
        loadingText.textContent = loadingMessages[i % loadingMessages.length];
        i++;
      }, 2000);
    }

    function hideLoading() {
      loading.classList.remove('active');
      generateBtn.disabled = false;
      clearInterval(loadingInterval);
    }

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.classList.add('active');
      hideLoading();
    }

    async function generateJoke(topic, apiKey) {
      const response = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: 'gpt-4o-mini',
          messages: [
            {
              role: 'system',
              content: 'You are a comedy writer specializing in Chuck Norris jokes. Create short, punchy, family-friendly Chuck Norris facts/jokes. Keep them under 20 words. Make them absurd and funny in the classic Chuck Norris fact style.'
            },
            {
              role: 'user',
              content: `Create a hilarious Chuck Norris joke about: ${topic}. Just respond with the joke, nothing else.`
            }
          ],
          max_tokens: 100,
          temperature: 0.9
        })
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error?.message || 'Failed to generate joke');
      }

      const data = await response.json();
      return data.choices[0].message.content.trim();
    }

    async function generateImage(topic, apiKey) {
      const response = await fetch('https://api.openai.com/v1/images/generations', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: 'dall-e-3',
          prompt: `Epic cinematic photo of Chuck Norris as a tough Texas Ranger cowboy, dramatic lighting, western desert background, ${topic} theme subtly incorporated, heroic pose, film grain, golden hour lighting. No text.`,
          n: 1,
          size: '1024x1024',
          quality: 'standard'
        })
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error?.message || 'Failed to generate image');
      }

      const data = await response.json();
      return data.data[0].url;
    }

    async function handleGenerate() {
      const topic = topicInput.value.trim() || 'being awesome';
      const apiKey = apiKeyInput.value.trim();

      if (!apiKey) {
        showError('Please enter your OpenAI API key');
        return;
      }

      showLoading();

      try {
        // Generate joke and image in parallel
        loadingText.textContent = "Generating Chuck Norris wisdom...";
        const [joke, imageUrl] = await Promise.all([
          generateJoke(topic, apiKey),
          generateImage(topic, apiKey)
        ]);

        loadingText.textContent = "Assembling the legend...";

        // Display results
        jokeText.textContent = joke;
        generatedImage.src = imageUrl;
        generatedImage.crossOrigin = "anonymous";

        generatedImage.onload = () => {
          hideLoading();
          resultSection.classList.add('active');
          
          // Update share links
          const shareText = encodeURIComponent(`${joke} ü§† #ChuckNorris #ChuckIt`);
          const shareUrl = encodeURIComponent(window.location.href);
          
          document.getElementById('shareTwitter').href = 
            `https://twitter.com/intent/tweet?text=${shareText}&url=${shareUrl}`;
          document.getElementById('shareFacebook').href = 
            `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}&quote=${shareText}`;
        };

        generatedImage.onerror = () => {
          showError('Failed to load the generated image');
        };

      } catch (error) {
        showError(error.message);
      }
    }

    generateBtn.addEventListener('click', handleGenerate);

    topicInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        handleGenerate();
      }
    });

    // Copy joke
    document.getElementById('copyJoke').addEventListener('click', async () => {
      const joke = jokeText.textContent;
      try {
        await navigator.clipboard.writeText(joke);
        const btn = document.getElementById('copyJoke');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<span>‚úì</span> Copied!';
        setTimeout(() => {
          btn.innerHTML = originalText;
        }, 2000);
      } catch (err) {
        showError('Failed to copy joke');
      }
    });

    // Download meme
    document.getElementById('downloadBtn').addEventListener('click', () => {
      const img = generatedImage;
      const joke = jokeText.textContent;

      canvas.width = img.naturalWidth;
      canvas.height = img.naturalHeight;

      // Draw image
      ctx.drawImage(img, 0, 0);

      // Add dark overlay
      ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Add text
      ctx.font = 'bold 48px "Bebas Neue", sans-serif';
      ctx.fillStyle = '#fff';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';

      // Text shadow
      ctx.shadowColor = '#000';
      ctx.shadowBlur = 8;
      ctx.shadowOffsetX = 3;
      ctx.shadowOffsetY = 3;

      // Word wrap
      const maxWidth = canvas.width - 100;
      const words = joke.split(' ');
      let lines = [];
      let currentLine = '';

      words.forEach(word => {
        const testLine = currentLine + word + ' ';
        const metrics = ctx.measureText(testLine);
        if (metrics.width > maxWidth && currentLine !== '') {
          lines.push(currentLine.trim());
          currentLine = word + ' ';
        } else {
          currentLine = testLine;
        }
      });
      lines.push(currentLine.trim());

      const lineHeight = 60;
      const startY = canvas.height / 2 - (lines.length - 1) * lineHeight / 2;

      lines.forEach((line, i) => {
        ctx.fillText(line, canvas.width / 2, startY + i * lineHeight);
      });

      // Download
      const link = document.createElement('a');
      link.download = 'chuck-norris-joke.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
  </script>
</body>
</html>
